# 언어 쌍별 테이블 사용 가이드

## 📋 개요

이제 단어 호버 기능이 언어 쌍별 테이블을 사용합니다. 각 언어 쌍에 대해 별도의 테이블이 생성되어 있으며, 텍스트의 언어와 사용자가 선택한 언어에 따라 적절한 테이블을 자동으로 참조합니다.

## 🔄 작동 방식

### 언어 쌍 테이블 선택 로직

1. **텍스트 언어 감지**: 호버하는 단어의 언어를 자동으로 감지
   - 영어: `en`
   - 일본어: `ja`
   - 한국어: `ko`
   - 중국어: `zh`

2. **사용자 언어 확인**: 설정에서 선택한 언어 가져오기

3. **테이블 선택**: `{텍스트언어}_{사용자언어}` 형식의 테이블 참조
   - 예: 영어 텍스트 + 사용자 언어 일본어 → `en_ja` 테이블
   - 예: 일본어 텍스트 + 사용자 언어 한국어 → `ja_ko` 테이블

### 예시

- **영어 지문 + 사용자 언어 일본어**: `en_ja` 테이블에서 영어 단어의 일본어 뜻 표시
- **일본어 지문 + 사용자 언어 한국어**: `ja_ko` 테이블에서 일본어 단어의 한국어 뜻 표시
- **한국어 지문 + 사용자 언어 일본어**: `ko_ja` 테이블에서 한국어 단어의 일본어 뜻 표시

## 📊 생성된 테이블 (12개)

1. `ja_ko` - 일본어 → 한국어
2. `ko_ja` - 한국어 → 일본어
3. `en_zh` - 영어 → 중국어
4. `zh_en` - 중국어 → 영어
5. `zh_ja` - 중국어 → 일본어
6. `ja_zh` - 일본어 → 중국어
7. `en_ja` - 영어 → 일본어
8. `ja_en` - 일본어 → 영어
9. `ko_en` - 한국어 → 영어
10. `en_ko` - 영어 → 한국어
11. `ko_zh` - 한국어 → 중국어
12. `zh_ko` - 중국어 → 한국어

## 🔧 수정된 함수들

### 1. `getLanguagePairTable(textLanguage, userLanguage)`
- 텍스트 언어와 사용자 언어를 받아서 적절한 테이블 이름 반환

### 2. `getWordMeaningFromLanguagePair(word, textLanguage, userLanguage)`
- 언어 쌍별 테이블에서 단어 뜻을 비동기로 가져오는 함수
- Supabase에서 해당 테이블을 조회하여 `target_meaning` 반환

### 3. `showWordTooltip(e)` (비동기)
- 영어 단어 호버 시 사용
- 언어 쌍별 테이블에서 뜻을 가져옴
- 폴백: 기존 TOEIC 사전 사용

### 4. `showKoreanWordTooltip(e)` (비동기)
- 한국어 단어 호버 시 사용
- `ko_{사용자언어}` 테이블에서 뜻을 가져옴

### 5. `showWordKanjiTooltip(e)` (비동기)
- 일본어 한자 호버 시 사용
- `ja_{사용자언어}` 테이블에서 뜻을 가져옴

## 📝 사용 방법

1. **Supabase에서 테이블 생성**
   - `create_language_pair_tables.sql` 실행

2. **데이터 마이그레이션**
   ```bash
   node migrate_to_language_pairs.js
   ```

3. **역방향 데이터 추가 (선택사항)**
   ```bash
   node add_reverse_direction_data.js
   ```

4. **브라우저에서 테스트**
   - 설정에서 언어 선택
   - 토익/JLPT/TOPIK 지문의 단어에 마우스를 올려보기
   - 선택한 언어에 맞는 뜻이 표시되는지 확인

## ⚠️ 주의사항

- **비동기 처리**: 모든 tooltip 함수가 비동기로 변경되었으므로 `async/await` 사용
- **폴백 처리**: 언어 쌍별 테이블에서 찾지 못한 경우 기존 사전 데이터 사용
- **텍스트 언어 감지**: `data-text-language` 속성 또는 `detectLanguage()` 함수로 자동 감지

## 🔍 디버깅

브라우저 콘솔에서 다음을 확인할 수 있습니다:
- 언어 쌍 테이블 조회 성공/실패
- 폴백 처리 여부
- 텍스트 언어 감지 결과

